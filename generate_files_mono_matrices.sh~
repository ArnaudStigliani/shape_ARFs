#!/bin/bash


results=../results/files_mono/
mkdir -p $results
negative_set_path=../lib/negative_arnaud/
genome=../data/tair10.fas

####################### ARF2 ###############################

sed 's/\./,/g' ../data/ARF2_peaks.narrowPeak | sort -k9,9nr -k7,7nr | head -600 | awk 'BEGIN{OFS="\t"}{print $1,$2+50,$3-50}' > $results/ARF2_top_regions.bed


python $negative_set_path/fonctions.py -pos $results/ARF2_top_regions.bed -neg ARF2_top_regions -o $results/ 

ARF2_fasta=$results/ARF2_top.fasta
ARF2_fasta_neg=$results/ARF2_top_neg.fasta

bed_train_pos=$(mktemp)
seq_train_pos=$(mktemp)
bedtools getfasta -fi $genome -fo $ARF2_fasta -bed $results/ARF2_top_regions.bed
grep ">" $ARF2_fasta | sed "s/>//" > $seq_train_pos
paste -d"\t" $results/ARF2_top_regions.bed $seq_train_pos > $bed_train_pos
cat $bed_train_pos  > $results/ARF2_top_regions.bed 

bed_train_neg=$(mktemp)
seq_train_neg=$(mktemp)
bedtools getfasta -fi $genome -fo $ARF2_fasta_neg -bed $results/ARF2_top_regions_1_neg.bed
grep ">" $ARF2_fasta_neg | sed "s/>//" > $seq_train_neg
paste -d"\t" $results/ARF2_top_regions_1_neg.bed $seq_train_neg > $bed_train_neg
cat $bed_train_neg  > $results/ARF2_top_regions_1_neg.bed 



# bed test files

sed 's/\./,/g' ../data/ARF2_peaks.narrowPeak | sort -k9,9nr -k7,7nr | tail -n +600  | awk -v OFS="\t" '{print $1,$2+50,$3-50}' > $results/ARF2_test.bed


python $negative_set_path/fonctions.py -pos $results/ARF2_test.bed -neg ARF2_test -o $results/ 


# fasta test files 

bed_pos=$(mktemp)
seq_pos=$(mktemp)
bedtools getfasta -fi $genome -fo $results/ARF2_test.fas -bed $results/ARF2_test.bed
grep ">" $results/ARF2_test.fas | sed "s/>//" > $seq_pos
paste -d"\t" $results/ARF2_test.bed $seq_pos > $bed_pos
cat $bed_pos  > $results/ARF2_test.bed 


bed_neg=$(mktemp)
seq_neg=$(mktemp)
bedtools getfasta -fi $genome -fo $results/ARF2_test_1_neg.fas -bed $results/ARF2_test_1_neg.bed
grep ">" $results/ARF2_test_1_neg.fas | sed "s/>//" > $seq_neg
paste -d"\t" $results/ARF2_test_1_neg.bed $seq_neg > $bed_neg
cat $bed_neg > $results/ARF2_test_1_neg.bed


####################### MP ###############################
